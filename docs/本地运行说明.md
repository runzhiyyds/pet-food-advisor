# 🐱 宠物口粮智能决策助手 - 本地运行指南

## 🚀 快速启动

### 方法一：使用启动脚本（推荐）
```bash
./start_local.sh
```

### 方法二：手动启动
```bash
# 1. 安装依赖
pip3 install -r requirements.txt

# 2. 初始化数据库
python3 sqlite_db_utils.py

# 3. 启动服务
python3 -m uvicorn main_sqlite:app --host 0.0.0.0 --port 8000 --reload
```

## 🌐 访问地址

启动成功后，可以通过以下地址访问：

- **前端页面**: http://localhost:8000
- **API文档**: http://localhost:8000/docs
- **健康检查**: http://localhost:8000/api/health

## 📋 功能演示流程

### 1. 填写宠物信息
- 访问 http://localhost:8000
- 填写宠物的基本信息（物种、品种、年龄、体重等）
- 选择预算模式和价格区间

### 2. 选择产品
- 从预置的猫粮产品中选择要分析的产品
- 或者选择"懒人推荐模式"自动选择

### 3. 等待AI分析
- 系统会模拟AI分析过程（约6-10秒）
- 可以看到实时的分析进度

### 4. 查看结果
- 产品以匿名代号（A、B、C等）展示
- 包含营养、适配度、安全性、性价比等评分
- 可以点击"揭晓"查看具体产品信息

## 🗄️ 数据库说明

本地版本使用SQLite数据库，具有以下特点：

- **数据文件**: `pet_food_selection.db`
- **预置数据**: 包含5款主流猫粮产品
- **无需安装**: 不需要安装MySQL等数据库软件
- **数据持久**: 重启后数据不会丢失

### 预置产品列表
1. 皇家猫粮成猫粮 - ¥22.25/斤
2. 渴望六种鱼全猫粮 - ¥83.06/斤
3. 爱肯拿鸭肉梨配方全猫粮 - ¥55.28/斤
4. 希尔思成猫粮鸡肉配方 - ¥39.75/斤
5. 蓝氏荒野鸡肉配方全猫粮 - ¥54.85/斤

## 🔧 技术特性

### 与原版的区别
- ✅ **数据库**: 使用SQLite替代MySQL
- ✅ **AI分析**: 使用模拟评分替代真实Dify API
- ✅ **功能完整**: 保留所有核心功能
- ✅ **部署简单**: 无需复杂的环境配置

### 模拟AI分析说明
- 使用随机算法生成评分（基于产品ID确保一致性）
- 包含营养成分、适配度、安全性、性价比四个维度
- 评分范围：60-98分
- 分析时间：每个产品约2秒

## 🛠️ 故障排除

### 端口被占用
```bash
# 查找占用8000端口的进程
lsof -i:8000

# 杀死进程
kill -9 <进程ID>
```

### 依赖安装失败
```bash
# 升级pip
pip3 install --upgrade pip

# 重新安装依赖
pip3 install -r requirements.txt
```

### 数据库问题
```bash
# 删除数据库文件重新初始化
rm pet_food_selection.db
python3 sqlite_db_utils.py
```

## 📊 API接口说明

### 主要接口
- `POST /api/pet/create` - 创建宠物信息
- `GET /api/products` - 获取产品列表
- `POST /api/analysis/start` - 启动分析
- `GET /api/analysis/progress/{session_id}` - 查询分析进度
- `GET /api/analysis/result/{session_id}` - 获取分析结果
- `POST /api/analysis/reveal/{session_id}/{code}` - 揭晓匿名产品

### 示例请求
```bash
# 创建宠物信息
curl -X POST http://localhost:8000/api/pet/create \
  -H "Content-Type: application/json" \
  -d '{"species":"猫","breed":"英短","age_months":24,"weight_kg":4.5}'

# 获取产品列表
curl http://localhost:8000/api/products

# 启动分析
curl -X POST http://localhost:8000/api/analysis/start \
  -H "Content-Type: application/json" \
  -d '{"pet_id":1,"product_ids":[1,2,3]}'
```

## 🎯 下一步开发

如果要继续完善这个项目，可以考虑：

1. **真实AI集成** - 接入真实的大模型API
2. **产品数据扩展** - 添加更多品牌和产品
3. **OCR功能** - 实现配料表图片识别
4. **用户系统** - 添加用户注册和历史记录
5. **移动端适配** - 优化移动设备体验

## 📞 技术支持

如果遇到问题，可以：
1. 查看服务器日志文件
2. 检查浏览器控制台错误
3. 确认网络连接正常
4. 重启服务尝试解决

---

**祝你使用愉快！** 🎉