# 🚀 宠物口粮智能助手 - 部署步骤指南

## ✅ 当前完成状态
- [x] 本地测试通过
- [x] Git 仓库已初始化
- [x] 代码已提交到本地仓库
- [ ] 创建 GitHub 仓库
- [ ] 推送代码到 GitHub
- [ ] 部署后端到 Render
- [ ] 配置前端 API 地址
- [ ] 部署前端到 GitHub Pages

---

## 📋 第一步：创建 GitHub 仓库

### 1.1 在 GitHub 创建新仓库

1. 打开浏览器，访问：https://github.com/new
2. 填写仓库信息：
   - **Repository name**: `pet-food-advisor`（或你喜欢的名字）
   - **Description**: `宠物口粮智能决策助手 - 帮助宠物主人科学选粮`
   - **Visibility**: 选择 `Public`（GitHub Pages 免费版需要公开仓库）
   - **不要勾选** "Add a README file"
   - **不要勾选** "Add .gitignore"
   - **不要勾选** "Choose a license"
3. 点击 **Create repository**

### 1.2 获取仓库地址

创建完成后，GitHub 会显示仓库地址，例如：
```
https://github.com/YOUR_USERNAME/pet-food-advisor.git
```

**请复制这个地址，我们接下来要用！**

---

## 📤 第二步：推送代码到 GitHub

在终端执行以下命令（**请先将 YOUR_USERNAME 替换为你的 GitHub 用户名**）：

```bash
cd "/Users/guochenyuan/Desktop/宠物粮选择_副本"

# 添加远程仓库（替换 YOUR_USERNAME）
git remote add origin https://github.com/YOUR_USERNAME/pet-food-advisor.git

# 推送代码
git branch -M main
git push -u origin main
```

**如果提示需要登录**，GitHub 现在需要使用 Personal Access Token：
1. 访问：https://github.com/settings/tokens
2. 点击 "Generate new token" → "Generate new token (classic)"
3. 勾选 `repo` 权限
4. 生成后复制 token
5. 在命令行输入密码时，使用这个 token 而不是密码

---

## 🖥️ 第三步：部署后端到 Render

### 3.1 注册 Render 账号

1. 访问：https://render.com
2. 点击 **Get Started for Free**
3. 选择 **Sign up with GitHub**（推荐）
4. 授权 Render 访问你的 GitHub 账号

### 3.2 创建 Web Service

1. 登录 Render Dashboard：https://dashboard.render.com/
2. 点击 **New +** → **Web Service**
3. 点击 **Connect account**（如果还没连接 GitHub）
4. 在仓库列表中找到 `pet-food-advisor`，点击 **Connect**

### 3.3 配置服务

填写以下信息：

| 配置项 | 值 |
|--------|-----|
| **Name** | `pet-food-advisor-api`（或你喜欢的名字） |
| **Environment** | `Python 3` |
| **Region** | `Singapore`（选择离你最近的） |
| **Branch** | `main` |
| **Root Directory** | 留空 |
| **Build Command** | `pip install -r requirements.txt` |
| **Start Command** | `uvicorn main_sqlite:app --host 0.0.0.0 --port $PORT` |
| **Plan** | `Free` |

### 3.4 环境变量（可选）

在 **Environment Variables** 部分，可以添加：
- `PYTHON_VERSION`: `3.11`

**注意**：`PORT` 变量 Render 会自动设置，不需要手动添加。

### 3.5 创建服务

1. 点击 **Create Web Service**
2. 等待部署完成（约 5-10 分钟）
3. 部署成功后，复制服务 URL，例如：
   ```
   https://pet-food-advisor-api.onrender.com
   ```

**⚠️ 重要：请记下这个 URL，下一步要用！**

### 3.6 测试后端

在浏览器访问：
```
https://你的服务名.onrender.com/docs
```

如果能看到 FastAPI 的 API 文档页面，说明后端部署成功！✅

---

## 🎨 第四步：配置前端 API 地址

**重要提示：请告诉我你的 Render 后端 URL，我会帮你更新前端配置！**

例如，如果你的 Render URL 是：
```
https://pet-food-advisor-api.onrender.com
```

我会帮你更新 `static/index.html` 文件中的 API 配置。

---

## 📱 第五步：部署前端到 GitHub Pages

### 5.1 启用 GitHub Pages

1. 访问你的 GitHub 仓库页面
2. 点击 **Settings**（设置）
3. 在左侧菜单找到 **Pages**
4. 在 **Source** 部分：
   - Branch: 选择 `main`
   - Folder: 选择 `/static`
5. 点击 **Save**

### 5.2 等待部署

1. 等待 1-3 分钟
2. 刷新页面，你会看到 GitHub Pages 的 URL：
   ```
   https://YOUR_USERNAME.github.io/pet-food-advisor/
   ```

### 5.3 访问应用

在浏览器访问你的 GitHub Pages URL，应该能看到应用首页！

---

## 🧪 第六步：完整功能测试

在 GitHub Pages 上测试以下功能：

- [ ] 页面能正常加载
- [ ] 填写宠物信息能正常提交
- [ ] 产品选择页面能正常显示
- [ ] 系统推荐功能正常
- [ ] 手动输入产品功能正常
- [ ] 开始分析功能正常
- [ ] 进度条能正常显示
- [ ] 分析结果能正常显示
- [ ] 匿名化显示正常
- [ ] Tab 切换正常
- [ ] 导出图片功能正常

---

## 🐛 常见问题解决

### 问题 1：CORS 错误

**现象**：浏览器控制台出现 CORS 错误

**解决方案**：
- 检查后端 `main_sqlite.py` 中 CORS 配置
- 确认 `allow_origins=["*"]` 已设置
- 重启 Render 服务

### 问题 2：404 错误

**现象**：API 请求返回 404

**解决方案**：
- 检查前端 `window.API_BASE_URL` 是否正确
- 确保后端 URL 包含 `https://`
- 检查后端服务是否正常运行

### 问题 3：后端休眠

**现象**：首次访问很慢（30秒左右）

**原因**：Render 免费计划在 15 分钟无活动后会休眠

**解决方案**：
- 这是正常的，等待唤醒即可
- 可以使用 UptimeRobot（免费）定期 ping 后端
- 或升级到付费计划（$7/月）

### 问题 4：分析功能不工作

**现象**：点击分析后没有反应

**可能原因**：
- Dify API 不可用（需要公司网络）
- 后端日志有错误

**解决方案**：
- 系统会自动降级为模拟评分
- 查看 Render Logs 确认错误

---

## 📊 部署信息记录

完成部署后，请记录以下信息：

### 后端信息
- **服务名称**: ________________
- **Render URL**: https://________________.onrender.com
- **部署时间**: ________________

### 前端信息
- **GitHub 用户名**: ________________
- **仓库名称**: ________________
- **GitHub Pages URL**: https://________________.github.io/________________/

### API 配置
- **API_BASE_URL**: https://________________.onrender.com

---

## 🎉 完成！

如果所有步骤都完成，你的应用就已经成功部署上线了！

**分享给朋友测试吧！** 🐾

---

## 📝 下一步

1. 分享给朋友测试
2. 收集用户反馈
3. 持续优化功能
4. 考虑添加更多宠物类型支持

---

## 🆘 需要帮助？

如果遇到问题：
1. 查看本文档的"常见问题解决"部分
2. 查看 GitHub Actions 日志
3. 查看 Render Logs
4. 检查浏览器控制台错误

祝部署顺利！🎊
